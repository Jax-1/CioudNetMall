<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<body>
		<!-- 内容部分 -->
	<div class="content_box">
		<div class="register_box"  >
			<div class="reg_tit">
				新用户注册
			</div>
			<span id="msg"></span>
			<form action="" id="registerform">
			<div class="form_ground_box">
				<lable class="reg_lab">手机号：</lable>
				<input type="text" class="input_width" name='user_name' id='user_name'>
				<span class="checkExistRong" id="checkExistPhone"></span>
			</div>
			<div class="form_ground_box">
				<lable class="reg_lab">密码设置：</lable>
				<input type="password" class="input_width" id='password' name='password'>
			</div>
			<div class="form_ground_box">
				<lable class="reg_lab">确认密码：</lable>
				<input type="password" class="input_width" id='Inputagain' name ='Inputagain'>
			</div>
			<div class="form_ground_box">
				<lable class="reg_lab">验证码：</lable>
				<input type="text" class="input_width_min" id='imgcode' name="imgcode">
				<a href="#" onclick="changeImg()">
				<img id="imgObj" class="validate_img" src="/img/getcode" alt="点击更换验证码" >
				</a>
			</div>
			<div class="form_ground_box">
				<lable class="reg_lab">短信验证码：</lable>
				<input type="text" class="input_width_min" id='phonecode' name="phonecode">
				<button type ="button" class="vali _img valid_btn" onclick="getphonecode()">获取短信验证</button>
			</div>
			<div class="form_ground_box center iagree">
				<input type="checkbox" class="agreeMent" id="agreeMent">
				<label for="agreeMent">我已阅读并同意</label> <span><a id="show_xieyi" href="javascript:void(0)">云网传媒协议规则</a></span>
				<div class="show_panner_xieyi">
                    <div class="tit_box"><span id="close">X</span></div>
                    <div class="agree_text">
                        <p class="tit_t">云网产业协议规则</p>
                        <p>第一条 竞投人是指在本网站进行注册并办理了必要手续、在销售活动中具有竞投权的个人及机构，否则不被视为正式竞投人。 必要的手续包含以下环节：</p>
                        <p>填写了系统要求的相关信息，并通过注册；</p>
                        <p>通过实名认证，并被审核成功；</p>
                        <p> 充值保证金成功，具有相应的竞买额度，以资金到达保证金账户的时间为准。</p>
                        
                        <p>第二条 云网文化产业实行会员制度。</p>
                        <p>第三条 依照适用法律能够合法签署具有法律约束力合同的个人和机构可以注册成为云网文化产业的会员。未满十八岁或不具有完全行为能力的个人不可注册为本网站的正式会员。个人申请注册，必须提供申请人的真实姓名、手机号码、身份证信息和电子邮件地址等真实材料，机构申请必须提供合法的企业(事业)注册文件。只有在云网文化产业注册的会员和具有相应数额的保证金才有权利在本网站购买物品。未经注册，任何人只可在云网文化产业上一定范围内浏览销售品或享受本网站的其它服务，但无资格在云网文化产业上参与抢购。</p>
                        <p>第四条 云网文化产业注册的会员采用保证金制。本保证金的意义在于维护卖家的权利及利益。 会员需先将资金存入其相应的资金账户，然后在个人账户中自行操作将资金转入保证金账户里，资金账户及保证金账户余额不计利息。会员拥有的购买额度是保证金数额的十倍数。对特别商品，须进行专门登记注册才具竞投权利。</p>
                        <p>保证金冻结规则：</p>
                        <p>1）每一件商品都有对应的保证金额度，这个额度会在每件商品的详情信息中明确标注。
                            <br> 2）买家对一件商品首次申请出价时，需要先支付对应的保证金。
                        </p>
                    	 <p>  保证金赔付流程：</p>
						<p>1）宝贝未抢购成功（出局），待销售结束后，系统会立即解冻保证金。</p>
						<p>2）抢购成功后，买家在24小时(可延时一次,最长48小时)交易付款期内及时完成付款后，系统会立即解冻保证金。</p>
						<p>3）抢购成功后，卖家主动违约，系统会立即解冻保证金。</p>
 						<p>第五条 云网文化产业会员推行保证金等级制度，只有在抢购前交纳相应数额的保证金才可成为相应级别的会员。会员在支付完所有的款项后，此保证金可以全额无息返还给会员，同时会员的竞买额度取消；如果有未结算的成交商品款项以及正在上拍的领先出价的商品，商品所占用额度的保证金无法退还给会员，占用额度为商品最终价格价或者当前领先出价金额的10% ；如果会员所有的保证金都被占用，则全额保证金均无法返还。</p>
						 <p>第六条 任何个人或机构，经在线注册，通过实名认证、并被审核成功，且成功充值了保证金后，将收到本网站发出确认的手机短信（形式不限于手机短信，还包括网站站内信、电子邮件、电话等其他有效的通知方式），至此，该个人或机构才成为正式会员。</p>
						<p> 第七条 云网文化产业有权自行决定在任何时候取消违反法律或本销售规则的会员权利，并不需承担与之相关的经济责任及法律责任。</p>
						<p> 第八条 任何会员自行保护自已的会员身份，除非云网文化产业书面认可某竞投人是表明身份的某会员的代理人，否则该竞投行为应被认为会员本人的行为，本公司不承担与之相关的经济责任及法律责任。</p>
						<p> 第九条 云网文化产业有权根据对本协议规则条款的解释平息销售过程中的任何争议。当销售出现异常情况，本公司有权予以协调解决。</p>
						<p> 第十条 竞买人抢购成功之后，即成为商品的买受人。除了商品本身的最终价格价，买受人还须自行承担交易本身支付、配送过程中发生的相关税费。如无特别提示，各项费用均以人民币结算。</p>

                        
                    </div>
                </div>
			</div>
			<div class="form_ground_box center">
				<div class="submitBtn" id="submit">
					立即注册
				</div>
			</div>
			<div class="go_login">
				已经注册过了，<a href="/user/login.do">去登录</a>
			</div>
			</form>
		</div>
	</div>
	<!-- 内容部分结束 -->
	 <script src="/admin/assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		function changeImg() {        
			        var imgSrc = $("#imgObj");    
			        imgSrc.attr("src", chgUrl());
		}
		// 时间戳
	    // 为了使每次生成图片不一致，即不让浏览器读缓存，所以需要加上时间戳
	    function chgUrl() {
	        var timestamp = (new Date()).valueOf();
	        var url='/img/getcode'+"?timestamp=" + timestamp;
	        return url;
	    }
		
		
		function getphonecode(){
			if($("#user_name").val()==''){
				return false;
			}
			
			$.post('/sms/getcode',{phone:$("#user_name").val()},function(data){
				console.log(data);
				if(data==null||data.code=='ok'){
					//短信发送失败
					$(".valid_btn").after("<span style='margin-left:10px;color:#cc0101'>发送失败</span>");
				}else{
					//短信发送成功、发送短信按钮60S不可点击
					$(".valid_btn").after("<span style='margin-left:10px;color:#01cc1c'>发送成功</span>");
					
					var maxtime = 9 ;   
			        function CountDown() {
			            if (maxtime >= 1) {
			               seconds = Math.floor(maxtime % 60);
			               msg = seconds + "秒重新发送";
			               $(".valid_btn").text(msg);
			               $(".valid_btn").removeAttr("onclick");
			               $(".valid_btn").css("background","#9e9b9b");
			               maxtime--;
			           } else{
			               clearInterval(timer);
			               $(".valid_btn").attr("onclick","getphonecode()");
			               $(".valid_btn").css("background","#FF6633");
			               $(".valid_btn").text("重新发送");
			           }
			       }
			       timer = setInterval(CountDown, 1000); 
				}
			});
			
		}
		$().ready(function(){
			// 协议
			$("#show_xieyi").click(function(){
				$(".show_panner_xieyi").show();
			})
			$("#close").click(function(){
				$(".show_panner_xieyi").hide();
			})
			//验证
			$("#registerform").validate({
				
				rules:{
					user_name:{
						required:true,
						userTel:true,
						checkUser:false
						
					},
					password:{
						required:true
					},
					Inputagain:{
						required:true,
						Inputagain:true
					}
					
				},
				messages:{
					user_name:{
						required: "请输入手机号"
					},
					password:{
						required:"密码不得为空！"
					},
					Inputagain:{
						required:"请再次输入密码！"
					}
					
				}
			});
			
			
		})
		$.validator.addMethod("userTel",function(value,element,params){
			 var pattern = /^1[34578]\d{9}$/;
            return this.optional(element)||pattern.test(value)
        },"请输入正确的手机号！");
		$.validator.addMethod("checkUser",function(value,element,params){
			var flg=false;
			console.log(element.value);
			 $.post('/user/checkname',{username:element.value},function(data){
				 if(data!=null&&data.res=='1'){
					 console.log(data);
					flg=true;
				 }
			 });
           return flg;
       },"该手机号已注册！");
		$.validator.addMethod("Inputagain",function(value,element,params){
			 if( element.value==null|| element.value!=$("#password").val()){
				 return false;
			 }
           return true;
       },"两次密码输入不一致！");
		$("#submit").click(function(){
			$.post('/user/register',
					{user_name:$("#user_name").val(),
					password:$("#password").val(),
					imgcode:$("#imgcode").val(),
					phonecode:$("#phonecode").val()
					},
					function(data){
						console.log(data);
					if(data!=null&&data.res=="1"){
						//注册成功
						$("#msg").text('');
						$("#msg").text(data.msg);
						setTimeout('showRes()',3000);
					}else{
						$("#msg").text('');
						$("#msg").text(data.msg);
					}
				
			});
		})
		//跳转到登录界面
		function showRes(){
			window.location.href="/user/login.do";
		}
	</script>
</body>
</html>