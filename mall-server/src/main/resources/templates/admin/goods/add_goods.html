<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
 <link rel="stylesheet" href="/admin/assets/layouts/layout/css/yunwang.css">
</head>
<body>
<div class="page-content-wrapper">
        <div class="page-content">
            <div class="page-bar">
                <ul class="page-breadcrumb">
                    <li>
                        <a href="index.html">首页</a>
                        <i class="fa fa-circle"></i>
                    </li>
                    <li>
                        <span>商品编辑</span>
                    </li>
                </ul>
            </div>
            <h1 class="page-title">商品编辑
                    <small>商品编辑和添加新商品</small>
            </h1>
            <!-- 内容展示 -->
            <div class="row">
                <div class="col-md-22">
                    <form class="form-horizontal" role="form" action="" method="get">
                        <div class="form-body">
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>商品名称</label>
                                <div class="col-md-3">
                                    <input type="text" class="form-control" placeholder="输入商品名称" name="goods_name">
                                    <span class="help-block">必填项 </span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">商品货号</label>
                                <div class="col-md-3">
                                    <input type="text" class="form-control" placeholder="商品货号" name="nickname">
                                    <span class="help-block">商家货号是指商家管理商品的编号，买家不可见最多可输入20个字符，支持输入中文、字母、数字、_、/、-和小数点</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>销售价格</label>
                                <div class="col-md-3">
                                    <input type="number" class="form-control" placeholder="0.00" name="goodsPrice.retail_price">
                                    <span class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em></em>是否特惠</label>
                                <div class="col-md-3">
                                    <label class="mt-checkbox mt-checkbox-outline">
                                        <input type="checkbox" value="Y" name="goodsPrice.sale" id="tehui">
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group" id="tehui_box">
                                <label class="col-md-2 control-label">特惠价格</label>
                                <div class="col-md-3">
                                    <input type="number" class="form-control" placeholder="0.00" name="goodsPrice.sale_price">
                                    <span class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>商品分类</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="goods_category" name="goodsInfo.goodsCategory.category_id">
                                        <option>书法</option>
                                        <option>山水</option>
                                    </select>
                                    <span class="help-block">若没有显示的分类，请到商品分类添加</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>商品尺寸</label>
                                <div class="col-md-3">
                                    <input type="text" class="form-control" placeholder="长X宽" name="goodsInfo.size">
                                    <span class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>商品平尺(官方)</label>
                                <div class="col-md-3">
                                    <input type="text" class="form-control" placeholder="平尺" name="goodsInfo.flat_feet">
                                    <span class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>库存</label>
                                <div class="col-md-3">
                                    <input type="number" name="goodsInfo.inventory.amount" class="form-control" placeholder="1">
                                    <span class="help-block">请填写整数</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>作家</label>
                                <div class="col-md-3">
                                    <select class="form-control" id="auth_id" name="goodsInfo.auth_id">
                                        <option>张三</option>
                                        <option>李四</option>
                                    </select>
                                    <span class="help-block">请选择相应的作家</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">装裱形式</label>
                                <div class="col-md-3">
                                    <select class="form-control" name="goodsInfo.framed">
                                        <option>无装裱</option>
                                        <option>立轴</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">环境</label>
                                <div class="col-md-3">
                                    <select class="form-control" name="goodsInfo.environment">
                                        <option>客厅</option>
                                        <option>卧室</option>
                                        <option>斗方</option>
                                        <option>办公室</option>
                                        <option>餐厅</option>
                                        <option>走廊</option>
                                        <option>酒楼</option>
                                        <option>其他</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">形制</label>
                                <div class="col-md-3">
                                    <select class="form-control" name="goodsInfo.standard">
                                        <option>竖幅</option>
                                        <option>横幅</option>
                                        <option>斗方</option>
                                        <option>条屏</option>
                                        <option>团扇</option>
                                        <option>册页</option>
                                        <option>手卷</option>
                                        <option>中堂</option>
                                        <option>对联</option>
                                        <option>不规则</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>商品图片</label>
                                <div class="col-md-2">
                                    <div class="file_img">
                                        <input id="show_img_file" type="file" name="image" multiple="multiple">
                                         <label for="show_img_file">点击上传</label>
                                         <div  style="height:10px;background:red;width:0px;"></div>
                                         <div class="progress">
											    <div class="progress-bar progress-bar-success" role="progressbar"
											         aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
											         id="processBar">
											        <span class="sr-only">90% 完成（成功）</span>
											    </div>
											</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="shop_img" id="shop_img">
                                    </div>
                                </div>
                            </div>
                             <div class="form-group">
                                <label class="col-md-2 control-label"><em>*</em>细节展示</label>
                                <div class="col-md-3">
                                     <!-- 编辑器 -->

                            <script src="/admin/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
                              <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.config.js"></script>
                              <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.all.min.js"> </script>
                              <script type="text/javascript" charset="utf-8" src="/ueditor/lang/zh-cn/zh-cn.js"></script>
      						  <script src="/admin/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        						<script src="../assets/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>

                              <div class="form-group">
                                    <div class="col-sm-2">
                                        <script id="editor" name="detail_describe" type="text/plain" style="width:800px;height:500px;"></script>
                                    </div>
                              </div>

                              <script type="text/javascript">
                                //实例化编辑器
                                //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
                                var ue = UE.getEditor('editor');
                                $("#submit").click(function(){
                                    var data = UE.getEditor('editor').getContent();
                                    $.ajax({
                                        cache: true,
                                        type: "GET",
                                        url: "http://localhost:8888/submit",
					                            　　　　　　　       　data: {
					                            　　　　　　　　　        　"edit": data
					                            　　　　　　　       　},

                                        async: false,
                                        error: function(request) {
                                            alert("Connection error");
                                        },
                                        success: function(){
                                            alert("success");
                                        }
                                    });
                                });
                            </script>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label"></label>
                                <div class="col-md-5 shop_check_box">
                                    <label class="mt-checkbox mt-checkbox-outline"> 设置推荐
                                        <input type="checkbox" value="Y" name="recommend">
                                        <span></span>
                                    </label>
                                    <label class="mt-checkbox mt-checkbox-outline"> 
                                    设置精品
                                        <input type="checkbox" value="1" name="classic">
                                        <span></span>
                                    </label>
                                    <label class="mt-checkbox mt-checkbox-outline"> 设置新品
                                        <input type="checkbox" value="1" name="new_product">
                                        <span></span>
                                    </label>
                                </div>
                            </div> 
                            <div class="form-group">
                                <label class="col-md-2 control-label"></label>
                                <div class="col-md-3">
                                    <button type="submit" class="btn green" name="submit">发布商品</button>
                                </div>
                            </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function(){
            if($("#tehui").is(':checked')){
                $("#tehui_box").show();
                console.log($("#tehui").val())
            }

            $("#tehui").change(function(){
                //如果选择了特惠,显示特惠输入
                if($("#tehui").is(':checked')){
                    $("#tehui_box").show();
                    // console.log($("#tehui").val())
                }else{
                    $("#tehui_box").hide();
                }
            })
			
			//加载下拉框
			 $.post("/admin/goods/category/de", {},
   		   		function(date){
   					$("#goods_category").html( buildMenu(date))
   		   		},'json'
   			   )  
			
			//递归分类
			function buildMenu(obj) {
            	var str='';
            	for(index in obj){
            		str += "<option value='"+obj[index].category_id+"'>"+ obj[index].category_name+"</option>";
            		str += buildMenu(obj[index].goodsCategoryList);
                }
            	return str;
    		}
			
            //商品图片上传预览
            $("#show_img_file").change(function(){
                console.log(111)
                var file=this.files[0];
                var formData = new FormData();
                formData.append("file",file);
                
                /* if(!/image\/\w+/.test(file.type)){ 
                    alert("请确保文件为图像类型"); 
                    return false; 
                } */
				$.ajax({
					type:"post",
					async:true,  //这里要设置异步上传，才能成功调用myXhr.upload.addEventListener('progress',function(e){}),progress的回掉函数
					Accept:'text/html;charset=UTF-8',
                    data:'/ueditor/uploade',
                    contentType:"multipart/form-data",
                    processData: false, // 告诉jQuery不要去处理发送的数据
                    contentType: false, // 告诉jQuery不要去设置Content-Type请求头
                    xhr:function(){                        
                        myXhr = $.ajaxSettings.xhr();
                        if(myXhr.upload){ // check if upload property exists
                            myXhr.upload.addEventListener('progress',function(e){                            
                                var loaded = e.loaded;                  //已经上传大小情况 
                                var total = e.total;                      //附件总大小 
                                var percent = Math.floor(100*loaded/total)+"%";     //已经上传的百分比  
                                console.log("已经上传了："+percent);                 
                                $("#processBar").css("width",percent);                                                                
                            }, false); // for handling the progress of the upload
                        }
                        return myXhr;
                    },                    
                    success:function(datas){                      
                        console.log("上传成功!!!!");    
                        console.log(datas)                    
                    },
                    error:function(){
                        alert("上传失败！");
                    }
                    
					})
				
                
                var reader=new FileReader();
                reader.readAsDataURL(file);
                reader.onload=function(){
                    // base64_code.innerHTML = this.result; 
                    $("#shop_img").html('<img src="'+this.result+'" alt=""/>'); 
                }
            })
        })
    </script>

</body>
</html>